/**
 * Common JS
 * Initialize modules
 */
$(function($){
  //Initialize Swiper
  var swiper = new Swiper('.swiper-slider', {
    pagination: '.swiper-pagination',
    paginationClickable: true,
    autoplay: 3000
  });
  var swiper = new Swiper('.swiper-gallery', {
    slidesPerView: 4,
    spaceBetween: 10,
    nextButton: '.swiper-button-next',
    prevButton: '.swiper-button-prev',
    breakpoints: {
      1049: {slidesPerView: 3},
      640: {slidesPerView: 2},
      320: {slidesPerView: 1}
    }
  });
  var swiper = new Swiper('.review-item-swiper-gallery', {
    slidesPerView: 6,
    spaceBetween: 5,
    nextButton: '.swiper-button-next',
    prevButton: '.swiper-button-prev',
    breakpoints: {
      717: {slidesPerView: 4},
      580: {slidesPerView: 3},
      470: {slidesPerView: 2},
      320: {slidesPerView: 1}
    }
  });
  var galleryTop = new Swiper('.gallery-top', {
    nextButton: '.swiper-button-next',
    prevButton: '.swiper-button-prev',
    spaceBetween: 0
  });
  var galleryThumbs = new Swiper('.gallery-thumbs', {
    spaceBetween: 5,
    slidesPerView: 'auto',
    touchRatio: 0.2,
    slideToClickedSlide: true
  });
  galleryTop.params.control = galleryThumbs;
  galleryThumbs.params.control = galleryTop;
  //Init Plus an attributes of product
  $('.plus').click(function () {
    var input_id = $(this).attr('data');
    var $input = $('#'+input_id);
    var val_int = parseInt($input.val());
    if (val_int < 1) {
      var val_int_plus = 1;
    } else if (val_int > 8) {
      var val_int_plus = 1;
    } else {
      var val_int_plus = parseInt($input.val()) + 1;
    }
    $input.val(val_int_plus);
    $('#val_'+input_id).html(val_int_plus);
    $input.trigger("click");
    return false;
  });
  //Init Minus an attributes of product
  $('.minus').click(function () {
    var input_id = $(this).attr('data');
    var $input = $('#'+input_id);
    var val_int = parseInt($input.val());

    if (val_int == 1) {
      var val_int_plus = 1;
    }else if (val_int < 1) {
      var val_int_plus = 1;
    } else {
      var val_int_plus = parseInt($input.val()) - 1;
    }
    $input.val(val_int_plus);
    $('#val_'+input_id).html(val_int_plus);
    $input.trigger("click");
    return false;
  });
  $('[autocomplete="off"]').click(function() {
    $('[autocomplete="off"]').parents().removeClass('active');
    $(this).parent().addClass('active');
  });
  $(".fancybox").fancybox({
    openEffect  : 'none',
    closeEffect : 'none',
    padding: 0,
    beforeShow: function() {
        $(".fancybox-image").click(function() {
          //Close fancybox
          $.fancybox.close();
        });
    }
  });
  // Validate phone numers
  jQ("#phone_action_main").mask("9(999)999-99-99");
  jQ("#phone_callback_main").mask("9(999)999-99-99");
  jQ("#phone_one_click").mask("9(999)999-99-99");
  jQ("#phone_search_cheaper").mask("9(999)999-99-99");
  jQ("#phone_order_product").mask("9(999)999-99-99");
  jQ("#phone_questions").mask("9(999)999-99-99");
  //jQ("#cart_phone").mask("9(999)999-99-99");
  jQ(".mask-phone").mask("9(999)999-99-99");
  //Phone fixed top 
  jQ(window).scroll(function() {
    if ($(this).scrollTop()>0) {
      jQ(".nav-top-fixed").fadeIn();
    } else {
      jQ(".nav-top-fixed").fadeOut();
    }
  });
  //Arrow "Go Up"
  if ($('#go_up').hasClass('go_up') && $('#go_down').hasClass('go_down')) {
    var linkUp = $('#go_up');
    var linkDown = $('#go_down');
    $(window).load(function () {
      currentPosition = $(this).scrollTop();
      if (currentPosition == 0) {
        linkUp.css({'opacity':'0.5'});
        linkDown.css({'opacity':'1'});
      } else if (currentPosition > 400) {
        linkDown.css({'opacity':'0.5'});
        linkUp.css({'opacity':'1'});
      }
    });
    $(window).scroll(function () {
      currentPosition = $(this).scrollTop();
      if (currentPosition == 0) {
        linkUp.css({'opacity':'0.5'});
        linkDown.css({'opacity':'1'});
      } else if (currentPosition > 400) {
        linkDown.css({'opacity':'0.5'});
        linkUp.css({'opacity':'1'});
      }
    });
    linkDown.click(function () {
      $('body,html').animate({
        scrollTop: $("body").height()},700);
      $(this).css({'opacity':'0.5'});
      linkUp.css({'opacity':'1'});
      return false;
    });
    linkUp.click(function () {
      $('body,html').animate({scrollTop:0},700);
      $(this).css({'opacity':'0.5'});
      linkDown.css({'opacity':'1'});
      return false;
    });
  }
//Set text for action on teplici
  jQ("#action_teplici_text").html('! Бесплатный фундамент и специальный подарок к каждой теплице!'); 
//jQ("#action_teplici_text").html('Минимальная цена, действует только с 23.12 по 29.12!');

  //Set date for action (every tuesday and friday) 
  var check_action_block = $("#action_date").size();
 
  //If action block is not empty
  if (check_action_block) {
    //Set variables
    var date = new Date();
    var get_day_now = date.getDay();

    //Set Friday or Tuesday
    if (get_day_now == 3 | get_day_now == 4 | get_day_now == 5) {
      //Set day Friday
      var dayOfWeek = 5;
    } else if (get_day_now == 6 | get_day_now == 0 | get_day_now == 1 | get_day_now == 2) {
      //Set day Tuesday
      var dayOfWeek = 2;
    }

    date.setDate(date.getDate() + (dayOfWeek + 7 - date.getDay()) % 7);
    var day = date.getDate();
    var months = ['Января','Февраля','Марта','Апреля','Мая','Июня','Июля','Августа','Сентября','Октября','Ноября','Декабря'];
    var month = months[date.getMonth()];
    //Set date in our block of action
    $("#action_date").html(day +' '+ month);
  }
  
  //Set date for action (every tuesday and friday) 
  var check_action_block = $("#action_date2").size();
 
  //If action block is not empty
  if (check_action_block) {
    //Set variables
    var date = new Date();
    var get_day_now = date.getDay();

    //Set Friday or Tuesday
    if (get_day_now == 3 | get_day_now == 4 | get_day_now == 5) {
      //Set day Friday
      var dayOfWeek = 5;
    } else if (get_day_now == 6 | get_day_now == 0 | get_day_now == 1 | get_day_now == 2) {
      //Set day Tuesday
      var dayOfWeek = 2;
    }

    date.setDate(date.getDate() + (dayOfWeek + 7 - date.getDay()) % 7);
    var day = date.getDate();
    var months = ['Января','Февраля','Марта','Апреля','Мая','Июня','Июля','Августа','Сентября','Октября','Ноября','Декабря'];
    var month = months[date.getMonth()];
    //Set date in our block of action
    $("#action_date2").html(day +' '+ month);
  }
  
  //Set date for action (every tuesday and friday) 
  var check_action_block = $("#action_date3").size();
 
  //If action block is not empty
  if (check_action_block) {
    //Set variables
    var date = new Date();
    var get_day_now = date.getDay();

    //Set Friday or Tuesday
    if (get_day_now == 3 | get_day_now == 4 | get_day_now == 5) {
      //Set day Friday
      var dayOfWeek = 5;
    } else if (get_day_now == 6 | get_day_now == 0 | get_day_now == 1 | get_day_now == 2) {
      //Set day Tuesday
      var dayOfWeek = 2;
    }

    date.setDate(date.getDate() + (dayOfWeek + 7 - date.getDay()) % 7);
    var day = date.getDate();
    var months = ['Января','Февраля','Марта','Апреля','Мая','Июня','Июля','Августа','Сентября','Октября','Ноября','Декабря'];
    var month = months[date.getMonth()];
    //Set date in our block of action
    $("#action_date3").html(day +' '+ month);
  }

  //Fixed new header
  var avatarElem = document.getElementById('heading');
  var avatarSourceBottom = avatarElem.getBoundingClientRect().bottom + window.pageYOffset;
  var window_width = window.innerWidth;
  window.onscroll = function() {
    if (avatarElem.classList.contains('heading-active') && window.pageYOffset < avatarSourceBottom) {
      avatarElem.classList.remove('heading-active');
      if (window_width>1050) {
        // jQ("#action_block_desktop").removeClass("hide").addClass("show");
        jQ("#action_block_desktop").css("display","block");
      } else {
        // jQ("#action_block_mobile").removeClass("hide").addClass("show");
        jQ("#action_block_mobile").css("display","block");
      }
      if (window_width<717) {
        jQ("#mobile-cities").css("display","block");
      }
    } else if (window.pageYOffset > avatarSourceBottom) {
      avatarElem.classList.add('heading-active');

      if (window_width>1050) {
        // jQ("#action_block_desktop").removeClass("show").addClass("hide");
        jQ("#action_block_desktop").css("display","none");
      } else {
        // jQ("#action_block_mobile").removeClass("show").addClass("hide");
        jQ("#action_block_mobile").css("display","none");
      }
      if (window_width<717) {
        jQ("#mobile-cities").css("display","none");
      }
    }
  };

/*
  var avatarElem = document.getElementById('nav-main');
  var avatarElem1 = document.getElementById('heading');
  var avatarSourceBottom = avatarElem.getBoundingClientRect().bottom + window.pageYOffset;
  var window_width = window.innerWidth;
  window.onscroll = function() {
    if (avatarElem.classList.contains('fixed') && window.pageYOffset < avatarSourceBottom) {
      avatarElem.classList.remove('fixed');
      avatarElem1.classList.remove('heading-active');
      if (window_width>1050) {
        // jQ("#action_block_desktop").removeClass("hide").addClass("show");
        jQ("#action_block_desktop").css("display","block");
      } else {
        // jQ("#action_block_mobile").removeClass("hide").addClass("show");
        jQ("#action_block_mobile").css("display","block");
      }
      if (window_width<717) {
        jQ("#mobile-cities").css("display","block");
      }
    } else if (window.pageYOffset > avatarSourceBottom) {
      avatarElem.classList.add('fixed');
      avatarElem1.classList.add('heading-active');
      if (window_width>1050) {
        // jQ("#action_block_desktop").removeClass("show").addClass("hide");
        jQ("#action_block_desktop").css("display","none");
      } else {
        // jQ("#action_block_mobile").removeClass("show").addClass("hide");
        jQ("#action_block_mobile").css("display","none");
      }
      if (window_width<717) {
        jQ("#mobile-cities").css("display","none");
      }
    }
  };
*/
  //If window resize
  // $(window).resize(function() {
  //   if (window_width>1050) {
  //     jQ("#action_block_desktop").css("display","block");
  //     jQ("#action_block_mobile").css("display","none");
  //   } else {
  //     jQ("#action_block_mobile").css("display","block");
  //     jQ("#action_block_desktop").css("display","none");
  //   }
  // });

  //Init city dropdown
  function hideallDropdowns() {
      $(".dropped .drop-menu-main-sub").hide();
      $(".dropped").removeClass('dropped');
      $(".dropped .drop-menu-main-sub .title").unbind("click");
  }
  function showDropdown(el) {
      var el_li = $(el).parent().addClass('dropped');
      el_li
          .find('.title')
          .click(function () {
              hideallDropdowns();
          })
          .html($(el).html());

      el_li.find('.drop-menu-main-sub').show();
  }
  $(".drop-down").click(function(){
      showDropdown(this);
  });
  $(document).mouseup(function () {
      hideallDropdowns();
  });

  //When main menu click
  $("#dropdownMainMenu,#dropdownMainMenu1,#dropdownMainMenu2,#dropdownMainMenu3").click(function() {

    //Returns width of browser viewport
    var get_width_of_browser = $(window).width();

    //If desktop or mobile
    if (get_width_of_browser > 530) {
      var width_true = 100;
    } else {
      var width_true = 60;
    }

    //Scroll to top
    $("html, body").animate({
      scrollTop: $(this).offset().top - width_true + "px"
    }, {
      duration: 700
    });
  });
});